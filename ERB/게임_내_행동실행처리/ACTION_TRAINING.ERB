;--------------------------------------------------
;鍛錬
@TRAINING
LOCAL:0 = 0
LOCAL:1 = 0
LOCAL:2 = 0
LOCAL:3 = 0
LOCAL:4 = 0
LOCAL:99 = 0
LOCAL:100 = 0
LOCAL:101 = 0

;基本の基礎値上昇量
;체력、기력の上昇量
LOCAL:0 = 45 + FLAG:50 * 25 / 100
;성내성、공격、방어、민첩、지성の上昇量
LOCAL:1 = 3 + FLAG:50 / 2
SIF !GAME_OPTION_CHECK_F(OPTION_hardcore)
	LOCAL:1 += 2
;○距離전투경험の上昇量
LOCAL:2 = 7 + FLAG:50 / 2
;経験Ｐの上昇量
LOCAL:3 = 2 + RAND:(5 + FLAG:50 * 2)
;子供の혈연보정
TRYCALL TRAINING_HOSEI_CHILD,LOCAL:0
LOCAL:0 = RESULT
TRYCALL TRAINING_HOSEI_CHILD,LOCAL:1
LOCAL:1 = RESULT
TRYCALL TRAINING_HOSEI_CHILD,LOCAL:2
LOCAL:2 = RESULT

;基本の체력減少量
CALL TRAINING_DOWNTAIRYOKU,TARGET
LOCAL:4 = RESULT
PRINTL 

;구상呼び出し：鍛錬開始
CALL MESSAGE_TRAINING_BEGIN

PRINTL どの鍛錬を行いますか？
PRINTFORML 現在の設備레벨：Lv.{FLAG:50}　消費체력：{LOCAL:4}

$INPUT_LOOP_SELECT
DRAWLINE
CALL SHOW_STATUS_BASE_TRAINING, TARGET

PRINTFORMLC [0] 走りこみ
PRINTFORMLC [1] 精神鍛錬
PRINTFORMLC [2] 瞑想
PRINTL 
PRINTFORMLC [3] 筋トレ
PRINTFORMLC [4] 自衛訓練
PRINTFORMLC [5] ダッシュ
PRINTL 
IF TALENT:변신능력 != -1
	PRINTFORMLC [6] 근거리戦闘訓練
	PRINTFORMLC [7] 중거리戦闘訓練
	PRINTFORMLC [8] 원거리戦闘訓練
	PRINTL 
ENDIF
PRINTFORMLC [9] 戦術研究
SIF TALENT:변신능력 == -1
	PRINTFORMLC [10]기초전투訓練
PRINTL 
DRAWLINE

IF CFLAG:110 > 0
	CALL RES_SCHEDULE, 110
ELSE
	$INPUT_LOOP
	INPUT
ENDIF
PRINTL 

CFLAG:101 = RESULT

IF RESULT == 0
	;지문: 鍛錬走りこみ
	CALL MESSAGE_TRAINING_HASHIRI

	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)
	LOCAL:100 = LOCAL:0

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "TAIRYOKU", TARGET, LOCAL:100
ELSEIF RESULT == 1
	;지문: 鍛錬精神鍛錬
	CALL MESSAGE_TRAINING_SEISHIN

	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)
	LOCAL:100 = LOCAL:0

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "KIRYOKU", TARGET, LOCAL:100
ELSEIF RESULT == 2
	;지문: 鍛錬瞑想
	CALL MESSAGE_TRAINING_MEISOU

	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)
	LOCAL:100 = LOCAL:1

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "SEITAISEI", TARGET, LOCAL:100
ELSEIF RESULT == 3
	;지문: 鍛錬筋トレ
	CALL MESSAGE_TRAINING_KINTORE

	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)
	LOCAL:100 = LOCAL:1

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "KOUGEKI", TARGET, LOCAL:100
ELSEIF RESULT == 4
	;지문: 鍛錬自衛訓練
	CALL MESSAGE_TRAINING_JIEI

	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)
	LOCAL:100 = LOCAL:1

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "BOUGYO", TARGET, LOCAL:100

ELSEIF RESULT == 5
	;지문: 鍛錬ダッシュ
	CALL MESSAGE_TRAINING_DASH

	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)
	LOCAL:100 = LOCAL:1

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "BINSYOU", TARGET, LOCAL:100
ELSEIF RESULT == 6 && TALENT:변신능력 != -1
	;지문: 鍛錬근거리戦闘訓練
	CALL MESSAGE_TRAINING_SHORT

	TIMES LOCAL:1, 0.30
	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "KOUGEKI", TARGET, LOCAL:100
	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BINSYOU", TARGET, LOCAL:100

	EXP:근거리전투경험 += LOCAL:2
	PRINTFORML 근거리戦闘が\@(LOCAL:2 <= 3 + FLAG:50) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 0
ELSEIF RESULT == 7 && TALENT:변신능력 != -1
	;지문: 鍛錬중거리戦闘訓練
	CALL MESSAGE_TRAINING_MIDDLE

	TIMES LOCAL:1, 0.30
	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "KOUGEKI", TARGET, LOCAL:100
	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BOUGYO", TARGET, LOCAL:100

	EXP:중거리전투경험 += LOCAL:2
	PRINTFORML 중거리戦闘が\@(LOCAL:2 <= 3 + FLAG:50) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 1
ELSEIF RESULT == 8 && TALENT:변신능력 != -1
	;지문: 鍛錬원거리戦闘訓練
	CALL MESSAGE_TRAINING_LONG

	TIMES LOCAL:1, 0.30
	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BOUGYO", TARGET, LOCAL:100
	LOCAL:100 = LOCAL:1
	CALL BASEUP, "BINSYOU", TARGET, LOCAL:100

	EXP:원거리전투경험 += LOCAL:2
	PRINTFORML 원거리戦闘が\@(LOCAL:2 <= 3 + FLAG:50) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 2
ELSEIF RESULT == 9
	;지문: 戦術研究
	CALL MESSAGE_TRAINING_TACTICS

	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)
	LOCAL:100 = LOCAL:1

	;非戦闘員は지성の伸びにボーナス
	SIF TALENT:변신능력 == -1
		TIMES LOCAL:100,1.5

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:100, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	CALL BASEUP, "CHISEI", TARGET, LOCAL:100
ELSEIF RESULT == 10 && TALENT:변신능력 == -1
	;지문: 기초전투訓練
	CALL MESSAGE_TRAINING_BASIS

	TIMES LOCAL:1, 0.30
	BASE:체력 =  LIMIT(BASE:체력 - LOCAL:4, 0, MAXBASE:체력)

	;촉수 구속구を着ている
	IF CFLAG:42 == 400
		TIMES LOCAL:1, 0.8
		;지문: 촉수 구속구が鍛錬の邪魔をする
		CALL MESSAGE_TRAINING_TENTACLECLOTH
	ENDIF

	LOCAL:100 = LOCAL:1
	CALL BASEUP, "CHISEI", TARGET, LOCAL:100

	LOCAL:2 = LOCAL:2 * (150 + ABL:기초전투 * 50) / 100 + RAND:3
	EXP:기초전투경험 += LOCAL:2
	PRINTFORML 戦闘の基礎が\@(LOCAL:2 <= 30 + FLAG:50 * 2) ?少し #\@上達した（＋{LOCAL:2}）
	CALL SENGIUP, TARGET, 3
ELSE
	IF CFLAG:111 > 0
		CALL REST
		GOTO END_TRAINING
	ENDIF
	PRINTL 正しい値を入力してください
	GOTO INPUT_LOOP
ENDIF

;경험치の取得
LOCAL = 10 + RAND(5)
CALL GET_EXP, LOCAL

CALL GET_SYUREN, LOCAL:3
;部位結界の上限設定
CALL BASEUP_CAL_SHIELD, TARGET

;実績
CALL GET_STATE_TROPHY,TARGET
PRINTL 

;구상呼び出し：鍛錬終了
CALL MESSAGE_TRAINING_END

PRINTW 

$END_TRAINING
BEGIN TURNEND

;--------------------------------------------------
;昼の場合、鍛錬に打ち込む度合いを決められる　（←　β２から決められなくした）
@TRAINING_DAYTIME, ARG:0, ARG:1, ARG:2, ARG:3, ARG:4
IF TIME == 0
	;PRINTFORML [0]全力で取り組む 체력 -{ARG:4 * 200 / 80}
	;PRINTFORML [1]普通に取り組む 체력 -{ARG:4}
	;$INPUT_LOOP_DOAI
	;INPUT
	;IF RESULT == 0
	;	ARG:0 = 20 * FLAG:50
	;	ARG:1 = 2 * FLAG:50
	;	ARG:2 = 6 * FLAG:50
	;	ARG:3 = 4 * FLAG:50
	;	ARG:4 = ARG:4 * 200 / 80
	;ELSEIF RESULT == 1
	;ELSE
		;GOTO INPUT_LOOP_DOAI
	;ENDIF
ENDIF
RETURN ARG:0, ARG:1, ARG:2, ARG:3, ARG:4

;---------------------------------------------------------
;トレーニングの消費체력計算
@TRAINING_DOWNTAIRYOKU, ARG
LOCAL = MAXBASE:ARG:체력
TIMES LOCAL, 0.10
IF FLAG:50 == 1
	TIMES LOCAL, 2.00
ELSEIF FLAG:50 == 2
	TIMES LOCAL, 1.80
ELSEIF FLAG:50 == 3
	TIMES LOCAL, 1.50
ELSEIF FLAG:50 == 4
	TIMES LOCAL, 1.25
ELSEIF FLAG:50 >= 5
	TIMES LOCAL, 1.00
ENDIF
LOCAL = SYOUHI_KEIGEN(TARGET,LOCAL,체력)
RETURN LOCAL
