;A攻め強

;性コマンド分類
@SEX_TYPE_COM5
RETURN 삽입

@SEX_COM5,ARG = 0,ARG:1 = 0
;EX_COM	追加責め実行部位（ビット）
;	1：Ｃ　2：Ｖ　4：Ａ　8：Ｂ
;追加責め
CALL SEX_COMEX_RANDOM, Ａ, ARG:1
EX_COM = RESULT:0
SH_COM = RESULT:1

;성기 가리개が残っている場合はＶ追加攻め플래그를折る
SIF CFLAG:42 == 398 && CLOTH_INNER_PER > 0 && (EX_COM & 질)
	EX_COM -= 질
;애널プレイはＶ挿入しない場合
SIF CONFIG_CHECK_OTHER_F(4) > 0 && (EX_COM & 질)
	EX_COM -= 질

;청순파なら１度だけ自動でＶ방어
SIF TALENT:청순파 > 0 && TCVARn:2 != 100 && (EX_COM & 질)
	CALL AUTO_V_DEFENCE, TARGET

;사정部位フラグ:애널を立てる
IF BASE:A결계내구력 <= 0
	TFLAG:4 = TFLAG:4 | 애널
	INSERT = INSERT | 애널
ENDIF
;Ｖ追加攻めがあるなら膣사정플래그를 세운다
IF (EX_COM & 질) && TCVARn:2 != 자세：Ｖ방어 && BASE:V결계내구력 <= 0
	TFLAG:4 = TFLAG:4 | 질
	INSERT = INSERT | 질
ENDIF
;Ｖ追加攻めがあり、挿入방어中ならワレメ사정플래그를 세운다
SIF (EX_COM & 질) && TCVARn:2 == 자세：Ｖ방어 && BASE:V결계내구력 <= 0
	TFLAG:4 = TFLAG:4 | 균열

;흑화 캐릭터のペニス位置をセット
SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1 && (ISPENIS(FLAG:111))
	TFLAG:18 = 애널

;取得パラメータ計算
;ベース値の明示的초기화
REPEAT 12
	LOCAL:COUNT = 0
REND

;방심도 상승
TFLAG:3 += 50

;사정値 300
CALL TENTACLE_SYASEI_UP, 300

;촉수サイズの설정
CALL SET_TENTACLE_SIZE, FLAG:10, FLAG:11, ENEMY_TYPE_CHECK_F("AKUOTI"), FLAG:111, 5

;快A　감각が低いうちは少なめ
IF CONFIG_CHECK_BALANCE_F(7) == 0
	IF ABL:A감각 == 0
		LOCAL:2 = 80
	ELSEIF ABL:A감각 == 1
		LOCAL:2 = 500
	ELSEIF ABL:A감각 == 2
		LOCAL:2 = 2000
	ELSEIF ABL:A감각 == 3
		LOCAL:2 = 4000
	ELSEIF ABL:A감각 == 4
		LOCAL:2 = 10000
	ELSEIF ABL:A감각 >= 5
		LOCAL:2 = 20000
	ENDIF
;컨피그オンで쾌A増加
ELSEIF CONFIG_CHECK_BALANCE_F(7) > 0
	IF ABL:A감각 == 0
		LOCAL:2 = 400
	ELSEIF ABL:A감각 == 1
		LOCAL:2 = 1000
	ELSEIF ABL:A감각 == 2
		LOCAL:2 = 2000
	ELSEIF ABL:A감각 == 3
		LOCAL:2 = 4000
	ELSEIF ABL:A감각 == 4
		LOCAL:2 = 10000
	ELSEIF ABL:A감각 >= 5
		LOCAL:2 = 20000
	ENDIF
ENDIF
;メイン部位絶頂見込みの予測
CALL PALAM_VABCestimate(LOCAL,2,-1)



IF ENEMY_TYPE_CHECK_F("MOB") == 1
	TRYCALLFORM MESSAGE_MOB_{ARG}_COM5, EX_COM, SH_COM
	;처녀なら고통が大量に入る
	IF TALENT:처녀 > 0 && (EX_COM & 2) && TCVARn:2 != 자세：Ｖ방어 && BASE:V결계내구력 <= 0
		LOCAL:10 = 10000
		TALENT:처녀 = -1
		CFLAG:206 = 2
		TCVARn:1 = 1
	ELSE
		LOCAL:10 = 0
	ENDIF
ELSE
	;처녀なら고통が大量に入る
	IF TALENT:처녀 > 0 && (EX_COM & 2) && TCVARn:2 != 자세：Ｖ방어 && BASE:V결계내구력 <= 0
		LOCAL:10 = 10000
		CALL LOSTVIRGIN
	ELSE
		LOCAL:10 = 0
	ENDIF
	;지문: 세뇌/흑화 캐릭터가 操作キャラにA攻め強をした
	SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
		CALL MESSAGE_OTHER_SEX_COM5
	;지문: COM5
	CALL MESSAGE_SEX_COM5, EX_COM, SH_COM
ENDIF

;結界による촉수本数の変動
CALL SET_TENTACLE_POOL
;服へのダメージ
CALL CLOTH_BATTLE_DAMAGE, 8

;ベース
IF EX_COM & Ａ
	EXP:A경험 += 2
	SIF INCEST_F(TARGET, FLAG:10 * 100 + FLAG:11, 1) > 0
		EXP:근친교배경험 += 1
	SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1 && INCEST_F(TARGET, FLAG:111) > 0
		EXP:근친교배경험 += 1
ENDIF



;공순
IF ABL:순종 <= 2
	LOCAL:5 = 200
ELSEIF ABL:순종 == 3
	LOCAL:5 = 500
ELSEIF ABL:순종 == 4
	LOCAL:5 = 1000
ELSEIF ABL:순종 >= 5
	LOCAL:5 = 2000
ENDIF

;습득
IF ABL:봉사정신 == 0
	LOCAL:6 = 20
ELSEIF ABL:봉사정신 == 1
	LOCAL:6 = 50
ELSEIF ABL:봉사정신 == 2
	LOCAL:6 = 100
ELSEIF ABL:봉사정신 == 3
	LOCAL:6 = 200
ELSEIF ABL:봉사정신 == 4
	LOCAL:6 = 500
ELSEIF ABL:봉사정신 >= 5
	LOCAL:6 = 1000
ENDIF

;굴복　A감각に応じて
IF ABL:A감각 == 0
	LOCAL:8 = 200
ELSEIF ABL:A감각 == 1
	LOCAL:8 = 400
ELSEIF ABL:A감각 == 2
	LOCAL:8 = 1000
ELSEIF ABL:A감각 == 3
	LOCAL:8 = 2000
ELSEIF ABL:A감각 == 4
	LOCAL:8 = 4000
ELSEIF ABL:A감각 >= 5
	LOCAL:8 = 9000 + ABL:A감각 * 200
ENDIF

;윤활が低いと고통が入る
IF ABL:A감각 < 3
	IF PALAM:윤활 < 100
		LOCAL:10 += 10000
	ELSEIF PALAM:윤활 < 10000
		LOCAL:10 += 1000
	ELSE
		LOCAL:10 += 100
	ENDIF
ELSE
	IF PALAM:윤활 < 100
		LOCAL:10 += 1000
	ELSEIF PALAM:윤활 < 10000
		LOCAL:10 += 100
	ELSE
		LOCAL:10 += 10
	ENDIF
ENDIF
SIF BASE:A결계내구력 > 0
	LOCAL:10 = 0

;감각が低いと공포が入る
IF ABL:A감각 == 0
	LOCAL:11 = 2000
ELSEIF ABL:A감각 == 1
	LOCAL:11 = 1000
ELSEIF ABL:A감각 == 2
	LOCAL:11 = 500
ELSEIF ABL:A감각 == 3
	LOCAL:11 = 200
ELSE
ENDIF
SIF BASE:A결계내구력 > 0
	LOCAL:11 = 0

;追加責め実行
IF EX_COM
	CALL SEX_COMEX, Ａ, 1, EX_COM | SH_COM
	REPEAT 12
		LOCAL:COUNT += RESULT:COUNT
	REND
ENDIF

;성내성が残り50%以上なら派生しにくい
IF PERCENT_CAL_F(BASE:성내성, MAXBASE:성내성) >= 50 && RAND:2 == 0
;ＶＡ挿入成功＆사정 게이지不足なら両穴ピストン＋강구속状態
ELSEIF (EX_COM & Ｖ) && (EX_COM & Ａ) && FLAG:15 < FLAG:14 && BASE:V결계내구력 == 0 && BASE:A결계내구력 == 0 && TCVARn:2 != 자세：Ｖ방어 && (ENEMY_TYPE_CHECK_F("MOB") == 0 && ENEMY_TYPE_CHECK_F("CITIZEN") == 0) && ISFEMALE()
	TFLAG:17 = 19
	;状態異常：강구속
	CALL STATE_CHANGE_PKOUSOKU, 100
;Ａ挿入成功＆사정 게이지不足なら애널ピストン＋강구속状態
ELSEIF (EX_COM & Ａ) && FLAG:15 < FLAG:14 && BASE:A결계내구력 == 0 && (ENEMY_TYPE_CHECK_F("MOB") == 0 && ENEMY_TYPE_CHECK_F("CITIZEN") == 0) && ISHOLE() == 1
	TFLAG:17 = 17
	;状態異常：강구속
	CALL STATE_CHANGE_PKOUSOKU, 100
ELSE
	;行動予約なし
	TFLAG:17 = -1
ENDIF
;촉수の行動を記録
TFLAG:20 = 5

;습득基本値
LOCAL:6 += 2000

;욕정基本値
LOCAL:7 += 0

;굴복基本値
LOCAL:8 += 4000

;치정基本値
LOCAL:9 += 800

;고통基本値
LOCAL:10 += 200

;공포基本値
LOCAL:11 += 500

;체력消費基本値
LOCAL:12 += 200

;計算へ
CALL PALAM_CAL, LOCAL:0, LOCAL:1, LOCAL:2, LOCAL:3, LOCAL:4, LOCAL:5, LOCAL:6, LOCAL:7, LOCAL:8, LOCAL:9, LOCAL:10, LOCAL:11, LOCAL:12
