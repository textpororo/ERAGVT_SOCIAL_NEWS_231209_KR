;--------------------------------------------------
;戦闘に関する共通関数


;--------------------------------------------------
;민첩の差による補正
@CORRECTION_BINSYOU, ARG
IF ARG < 10
	LOCAL = ARG * 15 / 100
ELSEIF ARG < 25
	LOCAL = ARG * 38 / 100
ELSEIF ARG < 45
	LOCAL = ARG * 75 / 100
ELSEIF ARG >= 75
	LOCAL = 64 + ARG * 15 / 100
ELSE
	LOCAL = ARG
ENDIF
RETURN LOCAL

;式中関数版
@CORRECTION_BINSYOU_F(ARG)
#FUNCTION
IF ARG < 10
	LOCAL = ARG * 15 / 100
ELSEIF ARG < 25
	LOCAL = ARG * 38 / 100
ELSEIF ARG < 45
	LOCAL = ARG * 75 / 100
ELSEIF ARG >= 75
	LOCAL = 64 + ARG * 15 / 100
ELSE
	LOCAL = ARG
ENDIF
RETURNF LOCAL

;--------------------------------------------------
;변신능력のあるキャラの補正
@CORRECTION_TRANS(ARG)
#FUNCTION
IF (TALENT:변신능력 == 1 && CFLAG:1 == 0) || TALENT:변신능력 == -1
	ARG = ARG * CFLAG:10 / 100
ELSEIF TALENT:변신능력 == 1 && CFLAG:1 == 2
	;SP변신の能力倍率は１００未満にならない
	LOCAL = CFLAG:11
	SIF LOCAL < 100
		LOCAL = 100
	ARG = ARG * LOCAL / 100
ENDIF
RETURNF ARG

;--------------------------------------------------
;戦技による行動成功値の補正
@CORRECTION_SENGI(ARG:0, ARG:1 ,ARG:2)
#FUNCTION
IF ARG:1 == 0
	LOCAL = 30
ELSEIF ARG:1 == 1
	LOCAL = 31
ELSEIF ARG:1 == 2
	LOCAL = 32
ENDIF
IF ABL:(ARG:2):LOCAL == 0
	TIMES ARG:0, 0.90
ELSEIF ABL:(ARG:2):LOCAL == 1
	TIMES ARG:0, 0.95
ELSEIF ABL:(ARG:2):LOCAL == 2
	TIMES ARG:0, 1.00
ELSEIF ABL:(ARG:2):LOCAL == 3
	TIMES ARG:0, 1.025
ELSEIF ABL:(ARG:2):LOCAL == 4
	TIMES ARG:0, 1.05
ELSEIF ABL:(ARG:2):LOCAL == 5
	TIMES ARG:0, 1.075
ELSEIF ABL:(ARG:2):LOCAL == 6
	TIMES ARG:0, 1.10
ELSEIF ABL:(ARG:2):LOCAL == 7
	TIMES ARG:0, 1.125
ELSEIF ABL:(ARG:2):LOCAL == 8
	TIMES ARG:0, 1.1375
ELSEIF ABL:(ARG:2):LOCAL == 9
	TIMES ARG:0, 1.15
ENDIF
RETURNF ARG:0

;--------------------------------------------------
;戦技による공격力の補正
@CORRECTION_SENGI_DAMAGE(ARG:0, ARG:1 ,ARG:2)
#FUNCTION
IF ARG:1 == 0
	LOCAL = 30
	IF ABL:(ARG:2):LOCAL == 0
		TIMES ARG:0, 1.00
	ELSEIF ABL:(ARG:2):LOCAL == 1
		TIMES ARG:0, 1.10
	ELSEIF ABL:(ARG:2):LOCAL == 2
		TIMES ARG:0, 1.15
	ELSEIF ABL:(ARG:2):LOCAL == 3
		TIMES ARG:0, 1.20
	ELSEIF ABL:(ARG:2):LOCAL == 4
		TIMES ARG:0, 1.25
	ELSEIF ABL:(ARG:2):LOCAL == 5
		TIMES ARG:0, 1.30
	ELSEIF ABL:(ARG:2):LOCAL == 6
		TIMES ARG:0, 1.35
	ELSEIF ABL:(ARG:2):LOCAL == 7
		TIMES ARG:0, 1.40
	ELSEIF ABL:(ARG:2):LOCAL == 8
		TIMES ARG:0, 1.45
	ELSEIF ABL:(ARG:2):LOCAL == 9
		TIMES ARG:0, 1.50
	ENDIF
ELSEIF ARG:1 == 1
	LOCAL = 31
	IF ABL:(ARG:2):LOCAL == 0
		TIMES ARG:0, 0.95
	ELSEIF ABL:(ARG:2):LOCAL == 1
		TIMES ARG:0, 1.00
	ELSEIF ABL:(ARG:2):LOCAL == 2
		TIMES ARG:0, 1.10
	ELSEIF ABL:(ARG:2):LOCAL == 3
		TIMES ARG:0, 1.20
	ELSEIF ABL:(ARG:2):LOCAL == 4
		TIMES ARG:0, 1.30
	ELSEIF ABL:(ARG:2):LOCAL == 5
		TIMES ARG:0, 1.40
	ELSEIF ABL:(ARG:2):LOCAL == 6
		TIMES ARG:0, 1.45
	ELSEIF ABL:(ARG:2):LOCAL == 7
		TIMES ARG:0, 1.50
	ELSEIF ABL:(ARG:2):LOCAL == 8
		TIMES ARG:0, 1.55
	ELSEIF ABL:(ARG:2):LOCAL == 9
		TIMES ARG:0, 1.60
	ENDIF
ELSEIF ARG:1 == 2
	LOCAL = 32
	IF ABL:(ARG:2):LOCAL == 0
		TIMES ARG:0, 0.90
	ELSEIF ABL:(ARG:2):LOCAL == 1
		TIMES ARG:0, 0.95
	ELSEIF ABL:(ARG:2):LOCAL == 2
		TIMES ARG:0, 1.05
	ELSEIF ABL:(ARG:2):LOCAL == 3
		TIMES ARG:0, 1.15
	ELSEIF ABL:(ARG:2):LOCAL == 4
		TIMES ARG:0, 1.30
	ELSEIF ABL:(ARG:2):LOCAL == 5
		TIMES ARG:0, 1.40
	ELSEIF ABL:(ARG:2):LOCAL == 6
		TIMES ARG:0, 1.50
	ELSEIF ABL:(ARG:2):LOCAL == 7
		TIMES ARG:0, 1.60
	ELSEIF ABL:(ARG:2):LOCAL == 8
		TIMES ARG:0, 1.65
	ELSEIF ABL:(ARG:2):LOCAL == 9
		TIMES ARG:0, 1.70
	ENDIF
ENDIF
RETURNF ARG:0

;--------------------------------------------------
;戦技による回避値の補正
@CORRECTION_SENGI_AVOID(ARG:0, ARG:1 = 0, ARG:2)
#FUNCTION
;근거리のみ補正を持つ
SIF ARG:1 != 0
	RETURNF ARG:0
LOCAL = 30
IF ABL:(ARG:2):LOCAL == 0
	TIMES ARG:0, 0.75
ELSEIF ABL:(ARG:2):LOCAL == 1
	TIMES ARG:0, 0.80
ELSEIF ABL:(ARG:2):LOCAL == 2
	TIMES ARG:0, 0.85
ELSEIF ABL:(ARG:2):LOCAL == 3
	TIMES ARG:0, 0.90
ELSEIF ABL:(ARG:2):LOCAL == 4
	TIMES ARG:0, 0.95
ELSEIF ABL:(ARG:2):LOCAL == 5
	TIMES ARG:0, 1.00
ELSEIF ABL:(ARG:2):LOCAL == 6
	TIMES ARG:0, 1.025
ELSEIF ABL:(ARG:2):LOCAL == 7
	TIMES ARG:0, 1.05
ELSEIF ABL:(ARG:2):LOCAL == 8
	TIMES ARG:0, 1.075
ELSEIF ABL:(ARG:2):LOCAL == 9
	TIMES ARG:0, 1.10
ENDIF
RETURNF ARG:0

;--------------------------------------------------
;行動制限
;各種刻印や特定の素質がついていると低確率で体が竦んで行動できなくなる
@ACT_LIMIT
LOCAL = 0
LOCAL:1 = 0
IF FLAG:72 > 0 && FLAG:70 > 0 && TFLAG:30 == 2 && TCVARn == 3
	PRINTL 
	PRINTFORML 戦っている%PRINT_TRANSCALLNAME(TARGET)%의 後ろにいる観衆が
	PRINTFORML さっきよりも近づいている気がする
ENDIF
IF TALENT:촉수의포로 == 1
	LOCAL = RAND:100
	IF LOCAL < 6
		;空中にいる場合は着地する
		SIF (TCVARn:216 & 1)
			TCVARn:216 = 4
		;FEAT 효과에 따른着地時の反動
		SIF TALENT:날개 > 0
			TFLAG:99 += 1
		;距離表示
		CALL PRINT_DISTANCE
		PRINTL 
		PRINTFORML %PRINT_TRANSCALLNAME(TARGET)%의 様子がおかしい・・・
		;지문 敵キャラの虜で体が竦む
		CALL MESSAGE_BATTLE_DISACTION_TORIKO
		;지문: 세뇌/흑화 캐릭터가 조작 캐릭터의 「촉수의포로で体が竦む」を見た
		SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
			CALL MESSAGE_OTHER_BATTLE_DISACTION_TORIKO
			
		RETURN 1
	ENDIF
ENDIF
IF TALENT:기생 == 1

	IF TALENT:공생 == 1
		;공생持ちの場合は行動制限発生確率を下げる
		LOCAL = RAND:200
	ELSE
		LOCAL = RAND:100
	ENDIF
	
	IF LOCAL < 6
		;空中にいる場合は着地する
		SIF (TCVARn:216 & 1)
			TCVARn:216 = 4
		;FEAT 효과에 따른着地時の反動
		SIF TALENT:날개 > 0
			TFLAG:99 += 1
		;距離表示
		CALL PRINT_DISTANCE
		PRINTL 
		PRINTFORML %PRINT_TRANSCALLNAME(TARGET)%의 様子がおかしい・・・
		;지문 기생した촉수が暴れて体が竦む
		CALL MESSAGE_BATTLE_DISACTION_PARASITE
		;지문: 세뇌/흑화 캐릭터가 조작 캐릭터의 「기생で体が竦む」を見た
		SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
			CALL MESSAGE_OTHER_BATTLE_DISACTION_PARASITE
			
		RETURN 1

	ENDIF
ENDIF
IF (TALENT:임신 == 4 || TALENT:임신 == 5) && CFLAG:222 >= 56
	LOCAL = RAND:100
	IF LOCAL < 3 + SQRT(CFLAG:222 / 4)
		;空中にいる場合は着地する
		SIF (TCVARn:216 & 1)
			TCVARn:216 = 4
		;FEAT 효과에 따른着地時の反動
		SIF TALENT:날개 > 0
			TFLAG:99 += 1
		;距離表示
		CALL PRINT_DISTANCE
		PRINTL 
		PRINTFORML %PRINT_TRANSCALLNAME(TARGET)%의 様子がおかしい・・・
		PRINTFORML %조사처리(PRINT_TRANSCALLNAME(TARGET),"는")%突然強い吐き気を感じて
		PRINTL 体が竦んでしまった・・・
		RETURN 1

	ENDIF
ENDIF
;악질 시민
IF FLAG:72 > 0 && FLAG:70 > 0 && TFLAG:30 > 2 && TCVARn == 3
	LOCAL = RAND:100
	IF LOCAL < 11
		;空中にいる場合は無効
		SIF (TCVARn:216 & 1)
			RETURN 1
		;距離表示
		CALL PRINT_DISTANCE
		PRINTL 
		PRINTFORML %조사처리(PRINT_TRANSCALLNAME(TARGET),"가")%動こうとすると
		PRINTFORML 観衆の一人に腕をつかまれてしまい
		PRINTFORML 動くことができなかった・・・
		RETURN 1

	ENDIF
ENDIF


LOCAL = 0

REPEAT 5
	;基本確率を설정
	IF MARK:COUNT == 0
		LOCAL = 0
	ELSEIF MARK:COUNT == 1
		LOCAL = 60
	ELSEIF MARK:COUNT == 2
		LOCAL = 120
	ELSEIF MARK:COUNT == 3
		LOCAL = 180
	ELSEIF MARK:COUNT == 4
		LOCAL = 240
	ELSEIF MARK:COUNT == 5
		LOCAL = 300
	ENDIF

	;성격 보정を설정
	IF COUNT == 0
		LOCAL:2 = 13
	ELSEIF COUNT == 1
		LOCAL:2 = 16
	ELSEIF COUNT == 2
		LOCAL:2 = 14
	ELSEIF COUNT == 3
		LOCAL:2 = 17
	ELSEIF COUNT == 4
		LOCAL:2 = 15
	ELSE
		PRINTW ERROR 刻印の호출先が不正です
		RETURN 0
	ENDIF
	LOCAL = SEIKAKU_HOSEI_PALAM_F(SEIKAKU_CHECK_F(TARGET), LOCAL:2, LOCAL)

	;刻印怯み無効の効果
	IF FLAG:905
		LOCAL = 0
	;刻印怯み２倍の効果
	ELSEIF FLAG:910
		LOCAL *= 2
	ENDIF
	
	IF LOCAL > 0
		LOCAL:1 = RAND:10000
		IF LOCAL:1 < LOCAL
			;空中にいる場合は着地する
			SIF (TCVARn:216 & 1)
				TCVARn:216 = 4
			;FEAT 효과에 따른着地時の反動
			SIF TALENT:날개 > 0
				TFLAG:99 += 1
			;距離表示
			CALL PRINT_DISTANCE
			PRINTL 
			PRINTFORML %PRINT_TRANSCALLNAME(TARGET)%의 様子がおかしい・・・
			IF COUNT == 0
				;지문 快楽で体が竦む
				CALL MESSAGE_BATTLE_DISACTION_KAIRAKU
				;지문: 세뇌/흑화 캐릭터가 조작 캐릭터의 「快楽で体が竦む」を見た
				SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
					CALL MESSAGE_OTHER_BATTLE_DISACTION_KAIRAKU
					
			ELSEIF COUNT == 1
				;지문 고통で体が竦む
				CALL MESSAGE_BATTLE_DISACTION_KUTUU
				;지문: 세뇌/흑화 캐릭터가 조작 캐릭터의 「고통で体が竦む」を見た
				SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
					CALL MESSAGE_OTHER_BATTLE_DISACTION_KUTUU
					
			ELSEIF COUNT == 2
				;지문 屈辱で体が竦む
				CALL MESSAGE_BATTLE_DISACTION_KUTUZYOKU
				;지문: 세뇌/흑화 캐릭터가 조작 캐릭터의 「屈辱で体が竦む」を見た
				SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
					CALL MESSAGE_OTHER_BATTLE_DISACTION_KUTUZYOKU

			ELSEIF COUNT == 3
				;지문 공포で体が竦む
				CALL MESSAGE_BATTLE_DISACTION_KYOUHU
				;지문: 세뇌/흑화 캐릭터가 조작 캐릭터의 「공포で体が竦む」を見た
				SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
					CALL MESSAGE_OTHER_BATTLE_DISACTION_KYOUHU

			ELSEIF COUNT == 4
				;지문 恥辱で体が竦む
				CALL MESSAGE_BATTLE_DISACTION_TIZYOKU
				;지문: 세뇌/흑화 캐릭터가 조작 캐릭터의 「恥辱で体が竦む」を見た
				SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 1
					CALL MESSAGE_OTHER_BATTLE_DISACTION_TIZYOKU

			ENDIF
			RETURN 1
		ENDIF
	ENDIF
REND
RETURN 0



;--------------------------------------------------
;撤退可能かどうかを判定する式中関数
@CHECK_CAN_RETREAT_F()
#FUNCTION
;デバッグ中は条件を無視して使用可能
IF FLAG:999 == 0
	;拘束されているならだめ
	SIF TCVARn:0 == 0
		RETURNF 0
	;악질 시민戦は拘束されてなければ逃げれる
	IF FLAG:73 > 0
		;악질 시민機能がオフの場合、8ターン目以降か체력, 기력どちらかが50%未満でないとだめ
		SIF CONFIG_CHECK_EVENT_F(3) == 0 && TFLAG:0 < 8 && PERCENT_CAL_F(BASE:체력, MAXBASE:체력) > 50 && PERCENT_CAL_F(BASE:기력, MAXBASE:기력) > 50
			RETURNF 0
		;악질 시민機能がオンの場合、避難が完了していないとだめ
		SIF CONFIG_CHECK_EVENT_F(3) > 0 && (FLAG:70 + FLAG:71) > 0
			RETURNF 0
		;襲撃イベント中ならだめ
		SIF GETBATTLESITUATION("철수 불가") > 0
			RETURNF 0
	ENDIF
ENDIF
;ここまで抜けて来たら使用可能
RETURNF 1





;--------------------------------------------------
;キャラクターの変身処理
;ARG	変身
@TRANSFORM, ARG, ARG:1 = -999
#DIM AIRPLUS

;ARG:1が省略された場合はTARGETを優先
SIF ARG:1 == -999
	ARG:1 = TARGET

;現在の変身状況（CFLAG:1）と目的となる変身状況（ARG）が同じなら終了
SIF CFLAG:(ARG:1):1 == ARG
	RETURN 0
SIF CFLAG:(ARG:1):1 == 0 && ARG == 0
	RETURN 0

;変身前の공중 성능 강화
CALL CLOTH_BATTLE_HOSEI, "AIRPLUS",ARG:1
AIRPLUS = RESULT

;공중 성능 강화の変動
CALL CLOTH_BATTLE_HOSEI, "AIRPLUS",ARG:1
IF AIRPLUS == 0 && RESULT > 0
	MAXBASE:(ARG:1):공중대시 += 1
	BASE:(ARG:1):공중대시 = MAXBASE:(ARG:1):공중대시
	SIF BASE:(ARG:1):공중대시 >= 5
		BASE:(ARG:1):공중대시 = 5
ELSEIF AIRPLUS == 1 && RESULT == 0
	MAXBASE:(ARG:1):공중대시 -= 1
	BASE:(ARG:1):공중대시 = MAXBASE:(ARG:1):공중대시
	SIF BASE:(ARG:1):공중대시 < 0
		BASE:(ARG:1):공중대시 = 0
ENDIF

;通常→変身
IF ARG > 0
	;남자が変身中に女体化する場合
	IF TALENT:(ARG:1):변신시TS > 0 && CHARATALENT_F(ARG:1,1,"남자") == 0
		TALENT:(ARG:1):남자 = -1
		TALENT:(ARG:1):처녀 = 1
		SIF TALENT:(ARG:1):변신시비처녀 > 0
			TALENT:(ARG:1):처녀 = -1
		;変身時濡れやすさ
		IF TALENT:(ARG:1):변신시젖기쉬움변동 == 1
			TALENT:(ARG:1):젖기쉬움 = 1
		ELSEIF TALENT:(ARG:1):변신시젖기쉬움변동 == -1
			TALENT:(ARG:1):젖기어려움 = 1
		ENDIF
		;変身時V감각
		IF TALENT:(ARG:1):변신시V감각변동 == 1
			TALENT:(ARG:1):V민감 = 1
		ELSEIF TALENT:(ARG:1):변신시V감각변동 == -1
			TALENT:(ARG:1):V둔감 = 1
		ENDIF
	;女が変身中に남자になる場合
	ELSEIF TALENT:(ARG:1):변신시TS > 0 && CHARATALENT_F(ARG:1,1,"남자") > 0
		TALENT:(ARG:1):남자 = 1
		SIF TALENT:(ARG:1):처녀 > 0
			TALENT:(ARG:1):처녀 -= 5
		SIF (TCVARn:12 & 배란)
			TCVARn:12 -= 배란
		TALENT:(ARG:1):젖기쉬움 *= -1
		TALENT:(ARG:1):젖기어려움 *= -1
		TALENT:(ARG:1):V민감 *= -1
		TALENT:(ARG:1):V둔감 *= -1
		TALENT:(ARG:1):빈유 *= -1
		TALENT:(ARG:1):거유 *= -1
	ENDIF
	;胸サイズ変動
	IF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) + TALENT:(ARG:1):변신시가슴사이즈변동 <= -2
		TALENT:(ARG:1):빈유 = 2
		TALENT:(ARG:1):거유 = 0
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) + TALENT:(ARG:1):변신시가슴사이즈변동 == -1
		TALENT:(ARG:1):빈유 = 1
		TALENT:(ARG:1):거유 = 0
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) + TALENT:(ARG:1):변신시가슴사이즈변동 == 1
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 1
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) + TALENT:(ARG:1):변신시가슴사이즈변동 == 2
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 2
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) + TALENT:(ARG:1):변신시가슴사이즈변동 == 3
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 3
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) + TALENT:(ARG:1):변신시가슴사이즈변동 == 4
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 4
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) + TALENT:(ARG:1):변신시가슴사이즈변동 >= 5
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 5
	ENDIF
	;体格変動
	IF MAX(TALENT:(ARG:1):장신,0) - MAX(TALENT:(ARG:1):왜소함,0) + TALENT:(ARG:1):변신시체격변동 < 0
		TALENT:(ARG:1):왜소함 = 1
		TALENT:(ARG:1):장신 = 0
	ELSEIF MAX(TALENT:(ARG:1):장신,0) - MAX(TALENT:(ARG:1):왜소함,0) + TALENT:(ARG:1):변신시체격변동 == 0
		TALENT:(ARG:1):왜소함 = 0
		TALENT:(ARG:1):장신 = 0
	ELSEIF MAX(TALENT:(ARG:1):장신,0) - MAX(TALENT:(ARG:1):왜소함,0) + TALENT:(ARG:1):변신시체격변동 > 0
		TALENT:(ARG:1):왜소함 = 0
		TALENT:(ARG:1):장신 = 1
	ENDIF
	;보추の入れ替え
	SWAP TALENT:(ARG:1):보추,TALENT:(ARG:1):변신시보추
	;후타나리の入れ替え
	SWAP TALENT:(ARG:1):후타나리,TALENT:(ARG:1):변신시후타나리
	;変身済み플래그를 세운다
	SIF TFLAG:700 > 0
		TCVARn:10 = 1
;変身→通常
ELSE
	;남자が変身中に女体化している場合
	IF TALENT:(ARG:1):변신시TS > 0 && CHARATALENT_F(ARG:1,0,"남자") > 0
		TALENT:(ARG:1):남자 = 1
		SIF TALENT:(ARG:1):처녀 == -1
			TALENT:(ARG:1):변신시비처녀 = 1
		TALENT:(ARG:1):처녀 = 0
		SIF (TCVARn:12 & 배란)
			TCVARn:12 -= 배란
		;濡れやすさ変動
		TALENT:(ARG:1):젖기쉬움 = 0
		TALENT:(ARG:1):젖기어려움 = 0
		;V감각変動
		TALENT:(ARG:1):V민감 = 0
		TALENT:(ARG:1):V둔감 = 0
	;女が変身中に남자になっている場合
	ELSEIF TALENT:(ARG:1):변신시TS > 0 && CHARATALENT_F(ARG:1,0,"남자") == 0
		TALENT:(ARG:1):남자 = 0
		SIF TALENT:(ARG:1):처녀 < -2
			TALENT:(ARG:1):처녀 += 5
		TALENT:(ARG:1):젖기쉬움 *= -1
		TALENT:(ARG:1):젖기어려움 *= -1
		TALENT:(ARG:1):V민감 *= -1
		TALENT:(ARG:1):V둔감 *= -1
		TALENT:(ARG:1):빈유 *= -1
		TALENT:(ARG:1):거유 *= -1
	ENDIF
	;胸サイズ変動
	IF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 <= -2
		TALENT:(ARG:1):빈유 = 2
		TALENT:(ARG:1):거유 = 0
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 == -1
		TALENT:(ARG:1):빈유 = 1
		TALENT:(ARG:1):거유 = 0
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 == 0
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 0
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 == 1
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 1
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 == 2
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 2
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 == 3
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 3
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 == 4
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 4
	ELSEIF MAX(TALENT:(ARG:1):거유,0) - MAX(TALENT:(ARG:1):빈유,0) - TALENT:(ARG:1):변신시가슴사이즈변동 >= 5
		TALENT:(ARG:1):빈유 = 0
		TALENT:(ARG:1):거유 = 5
	ENDIF
	;体格変動
	IF MAX(TALENT:(ARG:1):장신,0) - MAX(TALENT:(ARG:1):왜소함,0) - TALENT:(ARG:1):변신시체격변동 < 0
		TALENT:(ARG:1):왜소함 = 1
		TALENT:(ARG:1):장신 = 0
	ELSEIF MAX(TALENT:(ARG:1):장신,0) - MAX(TALENT:(ARG:1):왜소함,0) - TALENT:(ARG:1):변신시체격변동 == 0
		TALENT:(ARG:1):왜소함 = 0
		TALENT:(ARG:1):장신 = 0
	ELSEIF MAX(TALENT:(ARG:1):장신,0) - MAX(TALENT:(ARG:1):왜소함,0) - TALENT:(ARG:1):변신시체격변동 > 0
		TALENT:(ARG:1):왜소함 = 0
		TALENT:(ARG:1):장신 = 1
	ENDIF
	;보추の入れ替え
	SWAP TALENT:(ARG:1):보추,TALENT:(ARG:1):변신시보추
	;후타나리の入れ替え
	SWAP TALENT:(ARG:1):후타나리,TALENT:(ARG:1):변신시후타나리
ENDIF
;変身状況をARGに
CFLAG:(ARG:1):1 = ARG
;衣装チェック
CALL CLOTH_NO_INNER, TARGET
CLOTH_NO_INNER = RESULT

RETURN 1
