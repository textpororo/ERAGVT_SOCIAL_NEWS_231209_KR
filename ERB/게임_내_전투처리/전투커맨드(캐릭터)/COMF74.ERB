;SP풀버스트
@COM74

;距離表示
CALL PRINT_DISTANCE
PRINTL 

;疲労が蓄積し過ぎていると使用できない
IF CFLAG:99 >= 100
	PRINTFORML %PRINT_CALLNAME(TARGET)%に蓄積した疲労はもう限界に達している…！
	PRINTFORML SP풀버스트は使えない…！
	PRINTW 
	RETURN 0
ENDIF

TCVARn:0 = 2
TFLAG:4 = 0

;全ゲージ消費
TCVARn:6 = -500
;EX：攻防を解除
TCVARn:3 = 0

FONTBOLD
PRINTL SP풀버스트
FONTREGULAR

;지문: SP풀버스트
CALL MESSAGE_BATTLE_CHARA_SP_FBURST

;체력, 기력最大値、공격力、残ゲージ依存の固定ダメージ
LOCAL = MAX((MAXBASE:체력 + MAXBASE:기력 - 2000) + MAXBASE:공격 * 10, 800) * (100 + EX:행동포인트 * 2) * (5000 + TCVARn:5) / 500000

;直前に노려본다、매도한다、반항한다、설득해본다を使っていた場合ダメージ上昇
;SIF PREVCOM == 44 || PREVCOM == 45 || PREVCOM == 46 || PREVCOM == 47
;	LOCAL = LOCAL * 115 / 100
;雑魚にはダメージ強化
SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 0 && ENEMY_TYPE_CHECK_F("MOB") == 1
	LOCAL *= 2
;消耗度が低いとダメージ低下、高いとダメージ上昇
LOCAL = LOCAL * (300 - PERCENT_CAL_F(BASE:체력 + BASE:기력 + BASE:성내성 * 10, MAXBASE:체력 + MAXBASE:기력 + MAXBASE:성내성 * 10)) / 200
;변신능력のないキャラはリスクが少ないぶんダメージ低下
;SIF TALENT:변신능력 < 1
;	LOCAL = LOCAL * 85 / 100
;ダメージキャップ
LOCAL = LIMIT(LOCAL, 500, 99999)

FLAG:13 -= LOCAL
FONTBOLD
IF (FLAG:110 == 0)
	CALL TENTACLE_ACCESS, "NAME"
ELSEIF (FLAG:110 == 1)
	PRINTFORM %PRINT_TRANSCALLNAME(FLAG:111)%
ENDIF
PRINTFORML に{LOCAL}のダメージを与えた！

;トドメならデメリットなし
IF FLAG:13 <= 0
	TFLAG:99 = 0
ELSE
	;威力に応じて疲労が蓄積
	TFLAG:99 += MIN((1000 + TCVARn:5) * (100 + EX:행동포인트 * 2) / 10000, 15) + RAND:2
	;TFLAG:99 += 2 + MAX(TCVARn:4 + TCVARn:5 - 200, 0) * EX:행동포인트 / 400

	;反動として残り체력と기력の1/3分を消費
	LOCAL = BASE:체력 / 3
	LOCAL:1 = BASE:기력 / 3
	BASE:체력 -= LOCAL
	BASE:기력 -= LOCAL:1
	PRINTFORML 체력を{LOCAL}、기력を{LOCAL:1}消費した！
ENDIF
PRINTW 
FONTREGULAR

;残りのターンはEX使用不可となる
CALL ADDBATTLESITUATION("EX不可")

;행동포인트を半減
;SIF EX:행동포인트 > 0
;	EX:행동포인트 = EX:행동포인트 / 2 + 1

;촉수の体勢が崩れる
;TFLAG:1 = 1

RETURN 1
