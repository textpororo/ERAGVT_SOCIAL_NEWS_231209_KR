;ＳＰ버스트
@COM70

;距離表示
CALL PRINT_DISTANCE
PRINTL 

;疲労が蓄積し過ぎていると使用できない
IF CFLAG:99 >= 100
	PRINTFORML %PRINT_CALLNAME(TARGET)%に蓄積した疲労はもう限界に達している…！
	PRINTFORML ＳＰ버스트は使えない…！
	PRINTW 
	RETURN 0
ENDIF

TCVARn:0 = 2
TFLAG:4 = 0

;全ゲージ消費
TCVARn:6 += -500

FONTBOLD
PRINTL SPバースト
FONTREGULAR

;지문: SPバースト
CALL MESSAGE_BATTLE_CHARA_SP_BURST

;체력, 기력最大値、방어力、残ゲージ、행동포인트依存の固定ダメージ
LOCAL = MAX((MAXBASE:체력 + MAXBASE:기력 - 2000) * 2 + (MAXBASE:방어 - 100) * 3, 480) * POWER(MAX(TCVARn:4 + TCVARn:5 - 200, 0), 2) * (100 + EX:행동포인트 * 2) / 4800000 + 2500 * (CFLAG:1 == 2)

;直前に노려본다、매도한다、반항한다、설득해본다を使っていた場合ダメージ上昇
SIF PREVCOM == 44 || PREVCOM == 45 || PREVCOM == 46 || PREVCOM == 47
	LOCAL = LOCAL * 115 / 100
;雑魚にはダメージ強化
SIF ENEMY_TYPE_CHECK_F("AKUOTI") == 0 && ENEMY_TYPE_CHECK_F("MOB") == 1
	LOCAL *= 2
;消耗度が低いとダメージ低下、高いとダメージ上昇
LOCAL = LOCAL * (125 - PERCENT_CAL_F(BASE:체력 + BASE:기력 + BASE:성내성 * 40, MAXBASE:체력 + MAXBASE:기력 + MAXBASE:성내성 * 40)) / 100
;변신능력のないキャラはリスクが少ないぶんダメージ低下
SIF TALENT:변신능력 < 1
	LOCAL = LOCAL * 85 / 100
;ダメージキャップ
LOCAL = LIMIT(LOCAL, 500, 99999)

FLAG:13 -= LOCAL
FONTBOLD
IF (FLAG:110 == 0)
	CALL TENTACLE_ACCESS, "NAME"
ELSEIF (FLAG:110 == 1)
	PRINTFORM %PRINT_TRANSCALLNAME(FLAG:111)%
ENDIF
PRINTFORML に{LOCAL}のダメージを与えた！

;反動として残り체력と기력の1/4分を消費
LOCAL = BASE:체력 / 4
LOCAL:1 = BASE:기력 / 4
BASE:체력 -= LOCAL
BASE:기력 -= LOCAL:1
PRINTFORML 체력を{LOCAL}、기력を{LOCAL:1}消費した！
PRINTW 
FONTREGULAR

;威力に応じて疲労が蓄積
TFLAG:99 += 2 + MAX(TCVARn:4 + TCVARn:5 - 200, 0) * EX:행동포인트 / 400

;행동포인트を半減
SIF EX:행동포인트 > 0
	EX:행동포인트 = EX:행동포인트 / 2 + 1

;촉수の体勢が崩れる
TFLAG:1 = 1
;自動で戦闘メニューを選択する
TCVARn:8 = 1

RETURN 1
