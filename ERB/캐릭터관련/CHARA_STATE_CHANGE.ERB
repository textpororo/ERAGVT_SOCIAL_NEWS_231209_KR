;--------------------------------------------------
;状態異常の付与チェック(直接指定ではなく、戦闘中被弾に伴って状態遷移が起きるかどうかの判定)
;ARGは基礎確率
;--------------------------------------------------
;ダメージによる기절判定
@STATE_CHANGE_KIZETU_DAMAGE, ARG
SIF (TCVARn:12 & 기절)
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
;FEAT効果による状態異常無効
SIF TALENT:타고난전사 > 0
	RETURN 0
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	RETURN 0
LOCAL:0 = 0
CALL PERCENT_CAL, ARG, MAXBASE:체력
SIF RESULT >= 30
	LOCAL:0 += MAX(RESULT - 30, 0) / 4
IF CFLAG:99 >= 20
	LOCAL:0 += MAX(CFLAG:99 - 20, 0) * 2 + 10
ELSEIF CFLAG:99 >= 10
	LOCAL:0 += MAX(CFLAG:99 - 10, 0)
ENDIF
LOCAL:0 = LIMIT(LOCAL:0,0,50)
IF RAND:150 < LOCAL:0
	PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は大きすぎるダメージによって
	FONTBOLD
	SETCOLOR 250,180,50
	PRINT [기절]
	RESETCOLOR
	FONTREGULAR
	PRINTL した！
	PRINTW 
	TCVARn:12 |= 기절
	IF CONFIG_CHECK_SCREEN_F(2) > 0
		IF TCVARn:0 == 0
			TCVARn:8 = 2
		ELSE 
			TCVARn:8 = 0
		ENDIF
	ENDIF
ENDIF

;--------------------------------------------------
;絶頂した場合
@STATE_CHANGE_EX, ARG
VARSET LOCAL
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
FOR LOCAL, 0, 4
	LOCAL:1 += ABL:LOCAL
NEXT
;FEAT効果による状態異常無効
SIF TALENT:투쟁본능 > 0
	GOTO SKIP_1
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	GOTO SKIP_1
IF (RAND:100 < MIN(ARG * ARG * 4 + LOCAL:1 * 4, 75) || (TCVARn:12 & 발정)) && (TCVARn:12 & 기절) == 0 && (TCVARn:12 & 황홀) == 0
	PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は絶頂の余韻で
	FONTBOLD
	SETCOLOR 255,182,193
	PRINT [황홀]
	RESETCOLOR
	FONTREGULAR
	PRINTL としている！
	TCVARn:12 |= 황홀
	LOCAL ++
ENDIF
$SKIP_1

;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	GOTO SKIP_2
CALL TENTACLE_ACCESS, "GETNAME"
IF RAND:100 < ARG * ARG * 8 && (TCVARn:12 & 기절) == 0 && (TCVARn:12 & 황홀) == 0 && RESULTS != "Ｈ촉수"
	PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は激しい絶頂によって
	FONTBOLD
	SETCOLOR 250,180,50
	PRINT [기절]
	RESETCOLOR
	FONTREGULAR
	PRINTL した！
	TCVARn:12 |= 기절
	IF CONFIG_CHECK_SCREEN_F(2) > 0
		IF TCVARn:0 == 0
			TCVARn:8 = 2
		ELSE 
			TCVARn:8 = 0
		ENDIF
	ENDIF
	LOCAL ++
ENDIF
$SKIP_2

;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	GOTO SKIP_3
IF RAND:100 < ARG * ARG * 12 + 5 && (TCVARn:12 & 쓰러짐) == 0
	PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は
	FONTBOLD
	SETCOLOR 150,0,250
	PRINT [쓰러짐]
	RESETCOLOR
	FONTREGULAR
	PRINTL になってしまった！
	TCVARn:12 |= 쓰러짐
	LOCAL ++
ENDIF
$SKIP_3
SIF LOCAL > 0
	PRINTW 


;--------------------------------------------------
;電流を受けた場合(기절or마비が発生、)
@STATE_CHANGE_DENGEKI(ARG=100)
LOCAL = 0
SIF RAND:100 > ARG
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
;FEAT効果による状態異常無効
SIF TALENT:타고난전사 > 0
	GOTO SKIP_1
SIF TALENT:축복 > 0 && RAND:2 == 0
	GOTO SKIP_2
IF RAND:100 < 10 && (TCVARn:12 & 기절) == 0
	PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は電流のショックで
	FONTBOLD
	SETCOLOR 250,180,50
	PRINT [기절]
	RESETCOLOR
	FONTREGULAR
	PRINTL した！
	TCVARn:12 |= 기절
	IF CONFIG_CHECK_SCREEN_F(2) > 0
		IF TCVARn:0 == 0
			TCVARn:8 = 2
		ELSE 
			TCVARn:8 = 0
		ENDIF
	ENDIF
	LOCAL ++
ENDIF
$SKIP_1

;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && RAND:2 == 0
	GOTO SKIP_2
IF RAND:100 < 75 && (TCVARn:12 & 마비) == 0
	PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は全身が
	FONTBOLD
	SETCOLOR 250,250,0
	PRINT [마비]
	RESETCOLOR
	FONTREGULAR
	PRINTL した！
	TCVARn:12 |= 마비
	LOCAL ++
ENDIF
$SKIP_2
SIF LOCAL > 0
	PRINTW 


;마비(電撃以外の単独効果)
@STATE_CHANGE_MAHI, ARG
SIF (TCVARn:12 & 마비)
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	RETURN 0
SIF RAND:100 > ARG
	RETURN 0
PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は全身が
FONTBOLD
SETCOLOR 250,250,0
PRINT [마비]
RESETCOLOR
FONTREGULAR
PRINTL してしまった！
PRINTW 
TCVARn:12 |= 마비



;--------------------------------------------------
;기절
@STATE_CHANGE_KIZETU, ARG
SIF (TCVARn:12 & 기절)
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	RETURN 0
SIF RAND:100 > ARG
	RETURN 0
PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は
FONTBOLD
SETCOLOR 250,180,50
PRINT [기절]
RESETCOLOR
FONTREGULAR
PRINTL してしまった！
PRINTW 
TCVARn:12 |= 기절
IF CONFIG_CHECK_SCREEN_F(2) > 0
	IF TCVARn:0 == 0
		TCVARn:8 = 2
	ELSE 
		TCVARn:8 = 0
	ENDIF
ENDIF

;--------------------------------------------------
;배란
@STATE_CHANGE_HAIRAN, ARG
SIF TALENT:임신 > 0
	RETURN 0
SIF (TCVARn:12 & 배란)
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
SIF ISMALE()
	RETURN 0
;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	RETURN 0
SIF RAND:100 > ARG
	RETURN 0
PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は強制的に
FONTBOLD
SETCOLOR 150,0,250
PRINT [배란]
RESETCOLOR
FONTREGULAR
PRINTL 状態にされてしまった！
PRINTW 
TCVARn:12 |= 배란

;--------------------------------------------------
;발정
@STATE_CHANGE_HATUJOU, ARG
SIF (TCVARn:12 & 발정)
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && ARG < 100 && RAND:2 == 0
	RETURN 0
SIF RAND:100 > ARG
	RETURN 0
PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は媚薬の効果で
FONTBOLD
SETCOLOR 250,0,150
PRINT [발정]
RESETCOLOR
FONTREGULAR
PRINTL してしまった！
PRINTW 
TCVARn:12 |= 발정

;--------------------------------------------------
;끈적끈적
@STATE_CHANGE_BETOBETO, ARG
SIF (TCVARn:12 & 끈적끈적)
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
;FEAT効果による状態異常無効
SIF TALENT:축복 > 0 && ARG < 100 && RAND:4 != 0
	RETURN 0
SIF RAND:100 > ARG
	RETURN 0
PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は粘液で全身が
FONTBOLD
SETCOLOR 0,250,150
PRINT [끈적끈적]
RESETCOLOR
FONTREGULAR
PRINTL になってしまった！
PRINTW 
TCVARn:12 |= 끈적끈적

;--------------------------------------------------
;강구속(≒挿入されてる状態)
@STATE_CHANGE_PKOUSOKU, ARG
SIF (TCVARn:12 & 강구속)
	RETURN 0
;SP変身中は状態異常無効
SIF CFLAG:1 == 2
	RETURN 0
SIF RAND:100 > ARG
	RETURN 0
PRINTFORM %PRINT_TRANSCALLNAME(TARGET)%は
FONTBOLD
SETCOLOR 200,50,50
PRINT [강구속]
RESETCOLOR
FONTREGULAR
PRINTL 状態になってしまった！
PRINTW 
TCVARn:12 |= 강구속
;방어体勢をリセット
TCVARn:2 = 자세：통상



;非拘束時공격ヒット時に発生するエネミー独自の追加状態異常
;TCVARn:14…状態異常番号
;TCVARn:15…発生率
;	★状態異常はTCVARn:12準拠なのでビットで複数指定可能だが、
;	　発生率は現在一律になっている
;	　とりあえず技一つにつき単独指定を前提とする
@STATE_CHANGE_EXTRAEFFECT(ARG,ARG:1)
	SELECTCASE ARG
	CASE 1
		CALL STATE_CHANGE_KIZETU(ARG:1)
	CASE 2
		CALL STATE_CHANGE_HAIRAN(ARG:1)
	CASE 3
		CALL STATE_CHANGE_HATUJOU(ARG:1)
	CASE 4
		CALL STATE_CHANGE_DENGEKI(ARG:1)
	CASE 5
		CALL STATE_CHANGE_BETOBETO(ARG:1)
	CASE 6
		CALL STATE_CHANGE_MAHI(ARG:1)
	CASE 7
		CALL STATE_CHANGE_KIZETU_DAMAGE(ARG:1)
	ENDSELECT
;※腰砕け、황홀は絶頂から派生するサブ異常なので指定しない
;
@STATE_SET_EXTRAEFFECT(ARGS,ARG:1)
	SIF ARGS == "기절"
		TCVARn:14 = 1
	SIF ARGS == "배란"
		TCVARn:14 = 2
	SIF ARGS == "발정"
		TCVARn:14 = 3
	SIF ARGS == "電撃"
		TCVARn:14 = 4
	SIF ARGS == "끈적끈적"
		TCVARn:14 = 5
	SIF ARGS == "마비"	;非電撃由来
		TCVARn:14 = 6
	SIF ARGS == "기절ダメージ"
		TCVARn:14 = 7
	;基礎確率
	TCVARn:15 = ARG:1

