

;生理周期を表示
@PRINT_ESTRUS_CYCLE(ARG=-1)
	SIF ARG==-1
		ARG=TARGET
	SIF TALENT:ARG:미성숙>0 || ISMALE(ARG) ||  CHECK_PREGNANT_F(ARG) > 0
		RETURN

	LOCALS'=""
	;배란이상だと危険日開始が早まる
	IF CFLAG:ARG:217 >= (13 - TALENT:ARG:배란이상) && CFLAG:ARG:217 <= 15
		SETCOLOR 250,50,50
		LOCALS=危険日
	;危険日が終わると배란　배란이상では危険日以外の日にずっと배란
	ELSEIF TALENT:ARG:배란이상>=3 || (CFLAG:ARG:217>=16 && CFLAG:ARG:217<=(TALENT:ARG:배란이상==2 ? 19 # 18))
		SETCOLOR 250,30,200
		LOCALS=배란日
	;危険日の反対側に月経(生理)
	ELSEIF CFLAG:ARG:217 == 1
		SETCOLOR 50,120,230
		LOCALS=月経
	ENDIF
	IF LOCALS!=""
		PRINTFORM [%LOCALS%]
	ENDIF
	RESETCOLOR

;危険日or배란日なら「危険日」とテキストを返す式中関数
@ESTRUS_TEXT_F(ARG=-1,footertext="")
#FUNCTIONS
#DIMS footertext,1
	SIF ARG==-1
		ARG=TARGET
	SIF TALENT:ARG:미성숙>0 || ISMALE(ARG) ||  CHECK_PREGNANT_F(ARG) > 0
		RETURNF 

	LOCALS'=""
	;배란이상だと危険日開始が早まる
	IF CFLAG:ARG:217 >= (13 - TALENT:ARG:배란이상) && CFLAG:ARG:217 <= 15
		LOCALS=危険日%footertext%
	;危険日が終わると배란　배란이상では危険日以外の日にずっと배란
	ELSEIF TALENT:ARG:배란이상>=3 || (CFLAG:ARG:217>=16 && CFLAG:ARG:217<=(TALENT:ARG:배란이상==2 ? 19 # 18))
		LOCALS=危険日%footertext%
	ENDIF
	RETURNF LOCALS

;周期の進行(日付変更時に呼ばれる)
@ESTRUS_CYCLE(ARG=-1)
	SIF ARG==-1
		ARG=TARGET

	;サイクル進行中
	IF CFLAG:ARG:217>0
		;1-29の範囲でサイクル(배란이상だと周期最大値が早まる)
		IF CFLAG:ARG:217<=29-TALENT:ARG:배란이상*2
			CFLAG:ARG:217++
		;一周した
		ELSE
			CFLAG:ARG:217=1+TALENT:ARG:배란이상*2
		ENDIF
	;初期化用(1-29の範囲で設定)
	ELSE
		CFLAG:ARG:217=1+RAND:29
	ENDIF