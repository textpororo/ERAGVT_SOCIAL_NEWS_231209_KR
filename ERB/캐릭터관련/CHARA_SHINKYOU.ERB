;--------------------------------------------------
;캐릭터의 심경에 관한 처리
;--------------------------------------------------
;심경에 따른 보정 등
@SHINKYOU_CHECK, ARGS, ARG
IF TCVARn:1 == 0
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 보통
		CASE "PRINTSTATE"
			PRINT 보통（보정 없음）
	ENDSELECT
	RETURN ARG
ELSEIF TCVARn:1 == 1
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 도착(도착(倒錯))
		CASE "PRINTSTATE"
			PRINT 도착(도착(倒錯))（공・방・민 DOWN）
		CASE "KOUGEKI"
			TIMES ARG, 0.80
		CASE "BOUGYO"
			TIMES ARG, 0.80
		CASE "BINSYOU"
			TIMES ARG, 0.80
		CASE "CHISEI"
	ENDSELECT
	RETURN ARG
ELSEIF TCVARn:1 == 2
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 분노
		CASE "PRINTSTATE"
			PRINT 분노（공격・방어 UP　지성 DOWN）
		CASE "KOUGEKI"
			TIMES ARG, 1.20
		CASE "BOUGYO"
			TIMES ARG, 1.20
		CASE "BINSYOU"
		CASE "CHISEI"
			TIMES ARG, 0.80
	ENDSELECT
	RETURN ARG
ELSEIF TCVARn:1 == 3
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 체념
		CASE "PRINTSTATE"
			PRINT 체념（공격・방어・지성 DOWN）
		CASE "KOUGEKI"
			TIMES ARG, 0.80
		CASE "BOUGYO"
			TIMES ARG, 0.80
		CASE "BINSYOU"
		CASE "CHISEI"
			TIMES ARG, 0.80
	ENDSELECT
	RETURN ARG
ELSEIF TCVARn:1 == 4
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 냉정
		CASE "PRINTSTATE"
			PRINT 냉정（방어・민첩・지성 UP）
		CASE "KOUGEKI"
		CASE "BOUGYO"
			TIMES ARG, 1.20
		CASE "BINSYOU"
			TIMES ARG, 1.20
		CASE "CHISEI"
			TIMES ARG, 1.20
	ENDSELECT
	RETURN ARG
ELSEIF TCVARn:1 == 5
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 동요
		CASE "PRINTSTATE"
			PRINT 동요（방어・민첩 DOWN　지성 UP）
		CASE "KOUGEKI"
		CASE "BOUGYO"
			TIMES ARG, 0.80
		CASE "BINSYOU"
			TIMES ARG, 0.80
		CASE "CHISEI"
			TIMES ARG, 1.20
	ENDSELECT
	RETURN ARG
ELSEIF TCVARn:1 == 6
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 고양
		CASE "PRINTSTATE"
			PRINT 고양（공격・민첩 UP）
		CASE "KOUGEKI"
			TIMES ARG, 1.20
		CASE "BOUGYO"
		CASE "BINSYOU"
			TIMES ARG, 1.20
		CASE "CHISEI"
	ENDSELECT
	RETURN ARG
ELSEIF TCVARn:1 == 7
	SELECTCASE ARGS
		CASE "PRINT"
			PRINT 소침
		CASE "PRINTSTATE"
			PRINT 소침（공격・민첩 DOWN）
		CASE "KOUGEKI"
			TIMES ARG, 0.80
		CASE "BOUGYO"
		CASE "BINSYOU"
			TIMES ARG, 0.80
		CASE "CHISEI"
	ENDSELECT
	RETURN ARG
ENDIF


;--------------------------------------------------
;심경 변화 체크

;--------------------------------------------------
;공통 처리
@SHINKYOU_CHANGE, ARGS
LOCAL = 0
;심경 강도 판정
SELECTCASE TCVARn:1
	;도착(倒錯)
	CASE 1
		SIF (MESSAGE_BRANCH_F(TARGET) & 타락)
			LOCAL += 1
		SIF (MESSAGE_BRANCH_F(TARGET) & 쾌락굴복)
			LOCAL += 2
		SIF (MESSAGE_BRANCH_F(TARGET) & 성저항)
			LOCAL += 1
		SIF TCVARn:11 < 1
			LOCAL = 20
	;분노
	CASE 2
		SIF (MESSAGE_BRANCH_F(TARGET) & 고전) == 0
			LOCAL += 1
		SIF ARGS == "REISEI"
			LOCAL += 1
		SIF TCVARn:0 == 0
			LOCAL += 1
		SIF TCVARn:11 < 2
			LOCAL = 20
	;체념
	CASE 3
		SIF (MESSAGE_BRANCH_F(TARGET) & 절망)
			LOCAL += 2
		SIF (MESSAGE_BRANCH_F(TARGET) & 고전)
			LOCAL += 1
		SIF ARGS != "TOUSAKU" && ARGS != "DOUYOU" && ARGS != "SYOUTIN"
			LOCAL += 1
		SIF TCVARn:0 == 0
			LOCAL += 2
		SIF TCVARn:11 < 1
			LOCAL = 20
	;냉정
	CASE 4
		SIF (MESSAGE_BRANCH_F(TARGET) & 절망)
			LOCAL += 2
		SIF (MESSAGE_BRANCH_F(TARGET) & 성저항) == 0
			LOCAL += 1
		SIF ARGS == "KOUYOU"
			LOCAL += 1
		SIF TCVARn:11 < 2
			LOCAL = 20
	;동요
	CASE 5
		SIF (MESSAGE_BRANCH_F(TARGET) & 절망)
			LOCAL += 1
		SIF (MESSAGE_BRANCH_F(TARGET) & 고전)
			LOCAL += 1
		SIF TCVARn:0 == 0
			LOCAL += 2
		SIF TCVARn:11 < 1
			LOCAL = 20
	;고양
	CASE 6
		SIF (MESSAGE_BRANCH_F(TARGET) & 고전) == 0
			LOCAL += 1
		SIF (MESSAGE_BRANCH_F(TARGET) & 성저항) == 0
			LOCAL += 1
		SIF TCVARn:11 < 2
			LOCAL = 20
		SIF TCVARn:0 == 0
			LOCAL = 0
	;소침
	CASE 7
		SIF (MESSAGE_BRANCH_F(TARGET) & 절망)
			LOCAL += 1
		SIF (MESSAGE_BRANCH_F(TARGET) & 고전)
			LOCAL += 1
		SIF TCVARn:11 < 1
			LOCAL = 20
ENDSELECT
;심경 강도에 따라 심경이 변하기 어려워진다
SIF RAND:100 < LOCAL * 5
		RETURN 0

TRYCALLFORM SHINKYOU_CHANGE_%ARGS%

;--------------------------------------------------
;보통
;호출되면 무조건 보통으로 돌아간다
@SHINKYOU_CHANGE_NORMAL
SIF TCVARn:1 == 0
	RETURN
TCVARn:1 = 0
PRINTL 
PRINTFORM %PRINT_CALLNAME(TARGET,1)%의 심경이 
CALL SHINKYOU_CHECK, "PRINT", 0
PRINTL (으)로 변화하였다.
;심경의 지속 턴 초기화
TCVARn:11 = 0

;--------------------------------------------------
;도착(倒錯)
;체력과 기력 모두 60% 이하로 '도착(倒錯)' 이 되는 판정을 낸다
@SHINKYOU_CHANGE_TOUSAKU
LOCAL:0 = 0
LOCAL:1 = 0
CALL PERCENT_CAL, BASE:체력, MAXBASE:체력
LOCAL:0 = RESULT
CALL PERCENT_CAL, BASE:기력, MAXBASE:기력
LOCAL:1 = RESULT
;SP변신 중에는 체력, 기력 감소로 인한 영향을 받지 않는다
IF CFLAG:1 == 2
	LOCAL:0 = 100
	LOCAL:1 = 100
ENDIF
IF LOCAL:0 <= 60 && LOCAL:1 <= 60
CALL SEIKAKU_CHECK, "GET_TALENT_VALUE", TARGET
	CALL SEIKAKU_HOSEI_SHINKYOU, RESULT, "TOUSAKU"
	IF RAND:100 < RESULT
		IF TCVARn:1 != 1
			TCVARn:1 = 1
			;지문: 도착(倒錯)
			CALL MESSAGE_SHINKYOU_CHANGE_TOUSAKU
			;심경의 지속 턴 초기화
			TCVARn:11 = 0
		ENDIF
	ENDIF
ENDIF


;--------------------------------------------------
;분노/체념
;체력과 기력 모두 60% 이상으로 분노가 되는 판정을 낸다
;체력과 기력 모두 20% 이하로 체념이 되는 판정을 낸다
@SHINKYOU_CHANGE_IKARI_TEIKAN
LOCAL:0 = 0
LOCAL:1 = 0
CALL PERCENT_CAL, BASE:체력, MAXBASE:체력
LOCAL:0 = RESULT
CALL PERCENT_CAL, BASE:기력, MAXBASE:기력
LOCAL:1 = RESULT
;SP변신 중에는 체력, 기력 감소로 인한 영향을 받지 않는다.
IF CFLAG:1 == 2
	LOCAL:0 = 100
	LOCAL:1 = 100
ENDIF
IF LOCAL:0 >= 60 && LOCAL:1 >= 60
	CALL SHINKYOU_CHANGE_IKARI
ELSEIF LOCAL:0 <= 20 && LOCAL:1 <= 20
	CALL SHINKYOU_CHANGE_TEIKAN
ENDIF

@SHINKYOU_CHANGE_IKARI
CALL SEIKAKU_CHECK, "GET_TALENT_VALUE", TARGET
CALL SEIKAKU_HOSEI_SHINKYOU, RESULT, "IKARI"
IF RAND:100 < RESULT
	IF TCVARn:1 != 2
		TCVARn:1 = 2
		;지문: 분노
		CALL MESSAGE_SHINKYOU_CHANGE_IKARI
		;심경의 지속 턴 초기화
		TCVARn:11 = 0
	ENDIF
ENDIF

@SHINKYOU_CHANGE_TEIKAN
CALL SEIKAKU_CHECK, "GET_TALENT_VALUE", TARGET
CALL SEIKAKU_HOSEI_SHINKYOU, RESULT, "TEIKAN"
IF RAND:100 < RESULT
	IF TCVARn:1 != 3
		TCVARn:1 = 3
		;지문: 체념
		CALL MESSAGE_SHINKYOU_CHANGE_TEIKAN
		;심경의 지속 턴 초기화
		TCVARn:11 = 0
	ENDIF
ENDIF

;--------------------------------------------------
;냉정/동요
;체력과 기력 모두 60% 이상으로 냉정이 되는 판정을 낸다
;체력과 기력 모두 20% 이하로 동요가 되는 판정을 낸다
@SHINKYOU_CHANGE_REISEI_DOUYOU
LOCAL:0 = 0
LOCAL:1 = 0
CALL PERCENT_CAL, BASE:체력, MAXBASE:체력
LOCAL:0 = RESULT
CALL PERCENT_CAL, BASE:기력, MAXBASE:기력
LOCAL:1 = RESULT
;SP변신 중에는 체력, 기력 감소로 인한 영향을 받지 않는다.
IF CFLAG:1 == 2
	LOCAL:0 = 100
	LOCAL:1 = 100
ENDIF
IF LOCAL:0 >= 60 && LOCAL:1 >= 60
	CALL SHINKYOU_CHANGE_REISEI
ELSEIF LOCAL:0 <= 20 && LOCAL:1 <= 20
	CALL SHINKYOU_CHANGE_DOUYOU
ENDIF

@SHINKYOU_CHANGE_REISEI
CALL SEIKAKU_CHECK, "GET_TALENT_VALUE", TARGET
CALL SEIKAKU_HOSEI_SHINKYOU, RESULT, "REISEI"
IF RAND:100 < RESULT
	IF TCVARn:1 != 4
		TCVARn:1 = 4
		;지문: 냉정
		CALL MESSAGE_SHINKYOU_CHANGE_REISEI
		;심경의 지속 턴 초기화
		TCVARn:11 = 0
	ENDIF
ENDIF

@SHINKYOU_CHANGE_DOUYOU
CALL SEIKAKU_CHECK, "GET_TALENT_VALUE", TARGET
CALL SEIKAKU_HOSEI_SHINKYOU, RESULT, "DOUYOU"
IF RAND:100 < RESULT
	IF TCVARn:1 != 5
		TCVARn:1 = 5
		;지문: 동요
		CALL MESSAGE_SHINKYOU_CHANGE_DOUYOU
		;심경의 지속 턴 초기화
		TCVARn:11 = 0
	ENDIF
ENDIF

;--------------------------------------------------
;고양/소침
;체력과 기력 모두 60% 이상으로 고양이 되는 판정을 낸다
;체력과 기력 모두 20% 이하로 소침이 되는 판정을 낸다
@SHINKYOU_CHANGE_KOUYOU_SYOUTIN
LOCAL:0 = 0
LOCAL:1 = 0
CALL PERCENT_CAL, BASE:체력, MAXBASE:체력
LOCAL:0 = RESULT
CALL PERCENT_CAL, BASE:기력, MAXBASE:기력
LOCAL:1 = RESULT
;SP변신 중에는 체력, 기력 감소로 인한 영향을 받지 않는다.
IF CFLAG:1 == 2
	LOCAL:0 = 100
	LOCAL:1 = 100
ENDIF
IF LOCAL:0 >= 60 && LOCAL:1 >= 60
	CALL SHINKYOU_CHANGE_KOUYOU
ELSEIF LOCAL:0 <= 20 && LOCAL:1 <= 20
	CALL SHINKYOU_CHANGE_SYOUTIN
ENDIF

@SHINKYOU_CHANGE_KOUYOU
CALL SEIKAKU_CHECK, "GET_TALENT_VALUE", TARGET
CALL SEIKAKU_HOSEI_SHINKYOU, RESULT, "KOUYOU"
IF RAND:100 < RESULT
	IF TCVARn:1 != 6
		TCVARn:1 = 6
		;지문: 고양
		CALL MESSAGE_SHINKYOU_CHANGE_KOUYOU
		;심경의 지속 턴 초기화
		TCVARn:11 = 0
	ENDIF
ENDIF

@SHINKYOU_CHANGE_SYOUTIN
CALL SEIKAKU_CHECK, "GET_TALENT_VALUE", TARGET
CALL SEIKAKU_HOSEI_SHINKYOU, RESULT, "SYOUTIN"
IF RAND:100 < RESULT
	IF TCVARn:1 != 7
		TCVARn:1 = 7
		;지문: 소침
		CALL MESSAGE_SHINKYOU_CHANGE_SYOUTIN
		;심경의 지속 턴 초기화
		TCVARn:11 = 0
	ENDIF
ENDIF


